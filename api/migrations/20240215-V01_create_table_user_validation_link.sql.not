DO $$
BEGIN;

CREATE TABLE IF NOT EXISTS
  "user_validation_link" (
    "user_id" INTEGER NOT NULL REFERENCES "user" ("id") ON DELETE CASCADE,
    "validation_link" VARCHAR(255) NOT NULL,
    "created_at" TIMESTAMPTZ NOT NULL DEFAULT NOW()
    "updated_at" TIMESTAMPTZ
  );

CREATE TRIGGER update_ua_fields_user_validation_link BEFORE
UPDATE ON "user_validation_link" FOR EACH ROW
EXECUTE FUNCTION fill_updated_at ();


EXCEPTION WHEN others THEN RAISE NOTICE '%', SQLERRM;
ROLLBACK;
END $$;

-- MIGRATION DOWN

BEGIN;

DROP TRIGGER IF EXISTS update_ua_fields_user_validation_link ON "user_validation_link";

DROP TABLE IF EXISTS "user_validation_link";

COMMIT;